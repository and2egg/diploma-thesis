%% Based on a TeXnicCenter-Template, which was
%% created by Christoph Börensen
%% and slightly modified by Tino Weinkauf.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[a4paper,12pt]{scrartcl} %This is a special class provided by the KOMA script, which does a lot of adjustments to adapt the standard LaTeX classes to european habits, change to [a4paper,12pt,twoside] for doublesided layout


%########################### Preferences #################################


% ********* Font definiton ************
\usepackage{t1enc} % as usual
\usepackage[latin1]{inputenc} % as usual
\usepackage{times}		
%\usepackage{mathptmx}  	%mathematical fonts for use with times, I encountered some problems using this package togather with pdftex, which I was not able to resolve

% ********* Graphics definition *******
\usepackage[pdftex]{graphicx} % required to import graphic files
\usepackage{color} %allows to mark some entries in the tables with color
\usepackage{eso-pic} % these two are required to add the little picture on top of every page
\usepackage{everyshi} % these two are required to add the little picture on top of every page

% ********* Defining citation styles *********
\usepackage[backend=bibtex8,style=numeric]{biblatex}
% Select the bibliography file
\addbibresource{sources.bib}

\renewcommand{\floatpagefraction}{0.7} %default:0.5 allows two big pictures on one page

%********** Enybeling Hyperlinks *******
\usepackage[pdfborder=000,pdftex=true]{hyperref}% this enables jumping from a reference and table of content in the pdf file to its target

% ********* Table layout **************
\usepackage{booktabs}	  	%design of table, has an excellent documentation
%\usepackage{lscape}			%use this if you want to rotate the table together with the lines around the table

% ********* Caption Layout ************
\usepackage{ccaption} % allows special formating of the captions
\captionnamefont{\bf\footnotesize\sffamily} % defines the font of the caption name (e.g. Figure: or Table:)
\captiontitlefont{\footnotesize\sffamily} % defines the font of the caption text (same as above, but not bold)
\setlength{\abovecaptionskip}{0mm} %lowers the distace of captions to the figure


% ********* Header and Footer **********
% This is something to play with forever. I use here the advanced settings of the KOMA script

\usepackage{scrpage2} %header and footer using the options for the KOMA script
\renewcommand{\headfont}{\footnotesize\sffamily} % font for the header
\renewcommand{\pnumfont}{\footnotesize\sffamily} % font for the pagenumbers

%the following lines define the pagestyle for the main document
\defpagestyle{cb}{%
(\textwidth,0pt)% sets the border line above the header
{\pagemark\hfill\headmark\hfill}% doublesided, left page
{\hfill\headmark\hfill\pagemark}% doublesided, right page
{\hfill\headmark\hfill\pagemark}%  onesided
(\textwidth,1pt)}% sets the border line below the header
%
{(\textwidth,1pt)% sets the border line above the footer
{{\it Technical University of Vienna}\hfill Andreas Egger}% doublesided, left page
{Andreas Egger\hfill{\it Technical University of Vienna}}% doublesided, right page
{Andreas Egger\hfill{\it Technical University of Vienna}} % one sided printing
(\textwidth,0pt)% sets the border line below the footer
}

%this defines the page style for the first pages: all empty
\renewpagestyle{plain}%
	{(\textwidth,0pt)%
		{\hfill}{\hfill}{\hfill}%
	(\textwidth,0pt)}%
	{(\textwidth,0pt)%	
		{\hfill}{\hfill}{\hfill}%
	(\textwidth,0pt)}

%********** Footnotes **********
\renewcommand{\footnoterule}{\rule{5cm}{0.2mm} \vspace{0.3cm}} %increases the distance of footnotes from the text
\deffootnote[1em]{1em}{1em}{\textsuperscript{\normalfont\thefootnotemark}} %some moe formattion on footnotes

%################ End Preferences, Begin Document #####################

\pagestyle{plain} % no headers or footers on the first page

\begin{document}

\begin{center}

\vspace{4cm}

% There might be better solutions for the title page, giving all distances and sizes manually was simply the easiest solution

{\Huge\bf\sf Notes }

\vspace{.5cm}

{\Huge\bf\sf for }

\vspace{.5cm}

{\Huge\bf\sf Diploma Thesis}

\vspace{2cm}

{\Large\bf\sf Andreas Egger}%as this is an english text I didn't load the german package, this would ease the use of special characters

\vspace{.5cm}

{\Large\bf\sf 0626885}

\vspace{2cm}

{\Large\bf\sf \today} %adds the current date

\vspace{\fill}

egger.andreas.1@gmail.com

\end{center}
\newpage

%%The following loads the picture on top of every page, the numbers in \put() define the position on the page:
%\AddToShipoutPicture{\setlength\unitlength{0.1mm}\put(604,2522){\includegraphics[width=1.5cm]{logo.jpg}}}

\pagestyle{cb} % now we want to have headers and footers

\tableofcontents

\newpage

\section{General Concerns}

\subsection{Naming suggestion}

S1: Cost aware management of resources in distributed cloud data centers

S2: Cost aware resource management in distributed data centers

S3: Cost aware management of virtual machines in distributed cloud data centers

S4: Cloud management optimised for real-time electricity pricing

\subsection{VM Migrations and Forecasting}

{\hfill\today}
\vspace{0.4cm}

Forecasts can be made on the workload stream that is common to all data centers within the cloud. 
This will be a collection of CPU, RAM and disk data of the scheduled jobs to be run. 
The stream will be generated and can also be forecasted, but how to use?

With energy price forecasts you can check if the prices will significantly differ for a longer period of time 
in the future (long running jobs?). It makes sense especially for short term considerations (short running jobs). 

VM Migration (between data centers) only makes sense if the costs of migration is less than the benefit (lower energy price). 
Also it doesn't make sense if jobs are finishing soon (only consider longer running jobs). 


\subsection{Server Architecture}

\begin{itemize}
	
	\item Can a server host more than one virtual machine? Yes, see \cite{nelson2009virtual}.
	
	\item Can several jobs run on one server? (Depends on CPU and space requirements)
	
	\item Should different jobs run on different VMs on the same server? (I think so). 
	
	\item Share CPU power of two (or more) virtual machines on different hosts?

\end{itemize}


\subsection{Job Definition}

\begin{itemize}
	
	\item Job Requirements: 
	
		\subitem CPU power (frequency)
		
		\subitem CPU cores
		
		\subitem Expected Runtime
		
		\subitem Expected Costs (Derived)
		
		\subitem Meeting SLA (e.g. maximum price level)

\end{itemize}


\subsection{Workloads and test data}

Open Questions:

\begin{itemize}

\item How should workloads be generated?
	\subitem -> workloads are CPU traces of programs, probably distributed across several CPUs (CPU power load)
	\subitem -> define applications to run with different workloads
	
\item Which programs should be used? 
	\subitem \underline{Matlab}
	\subitem R
	\subitem Mathcad
	\subitem \ldots
\item Which kind of distribution should they exhibit (time series)?
\item Is there a way to get workload traces / time series data from real data centers?

\end{itemize}

\subsection{Workload traces}

A workload trace is common for all data centers, since they are administrated from one central point. 
From there the workload is distributed across the data centers, already taking into account electricity cost. 
When a new request arrives, it is checked whether the application can be served at any of the data centers. 
If not, the start is delayed until resources are available. Otherwise it is assigned to the presumably cheapest
data center. If later the prices change load will be migrated from more expensive to cheaper data centers. 


\subsection{Definition of Terms}

\begin{itemize}

\item Power Usage Effectiveness

Developed by The Green Grid, Power usage effectiveness (PUE) is a data center metric that measures the amount of power directly used by IT resources such as servers and routers compared to the overall energy consumption of the data center. A PUE value of 2 means that there is as much energy used to power non-IT equipment such as cooling facilities etc. as there is to power IT devices. 
% takes the total power used by a data center and divides it by the amount of power used by the IT hardware housed in the data center. (source: http://tech.ebay.com/about-dashboard)

\item Energy Elasticity

degree to which the energy consumed by a cluster depends on the load placed on it. Ideally, clusters would draw no power in the absence of load. In the worst case, there would be no difference between the peak power and the idle power of a cluster. Present state-of-the-art systems fall somewhere in the middle, with idle power being around 60\% \cite{qureshi2009cutting}.

\item Colocation providers

A colocation provider denotes a facility manager that provides space and server infrastructures to industrial customers that rent the space and infrastructure to house their customers' applications. 

\end{itemize}


\section{Goals}

\subsection{What I want to show in my thesis}

The goal of this thesis is to show ways for data center operators in charge of geographically distributed and interconnected data centers to save on their power bill by exploiting VM migrations and the variability of energy prices in wholesale power markets. This approach presumes that data center operators are charged directly by wholesale power markets, which is the case already for a few data centers to date. By leveraging the technique of migration of resources to data centers where cheaper energy prices apply at the current point in time significant savings in energy bills are possible. 

By initially placing resources at data centers that currently exhibit cheap energy prices the energy expense can be reduced compared to a non power aware approach. Combined with energy price forecasts resources may be scheduled intelligently such that price changes within the near future can be detected and resources are placed with respect to the estimated prices. This approach may be evaluated against an ad-hoc approach where resources are assigned to data centers by only considering current energy prices and workload. 



Given the fact that data centers consume a huge amount of energy (several megawatts) that could power whole cities it becomes a viable option to integrate them into wholesale energy markets. Arising challenges and opportunities related to integration into energy markets will be discussed in later chapters. 


\section{Forecasting}

\subsection{Definition}

A very general definition of forecasting and its prerequisites is given here \footnote{O-Texts https://www.otexts.org/fpp/1/1}:

\begin{quote}
The predictability of an event or a quantity depends on several factors including:

\begin{itemize}
\item how well we understand the factors that contribute to it
\item how much data are available
\item whether the forecasts can affect the thing we are trying to forecast
\end{itemize}
\end{quote}


\subsection{Types of forecasting}

%Forecasting can be done in different ways, each having their own drawbacks and benefits. 

Forecasting methods can be classified into two categories: Qualitative and Quantitative forecasting. 

\begin{itemize}
\item Qualitative forecasting methods assume that there is no or no relevant data that can be used to make forecasts. This is the case for forecasts that aim to predict i.e. the first year's sales of a new product line or the expected profit of a newly created startup company. In both examples there is no data available beforehand and the forecast has to be derived from already known conditions also called predictor variables. 

\item Qantitative forecasting methods are based on numerical historical data, from which forecasts are derived. It is assumed that the data´s pattern over time stays the same or will behave in a similar way in the future. 
\end{itemize}

Quantitative forecasting methods can again be classified roughly into two categories: Cross-sectional forecasting and Time Series forecasting. 

\begin{itemize}
\item Cross-sectional forecasts collect data from a single point in time to predict a value for an item not in the dataset. For example, prices of real estates in a specific area and point in time are collected and the price for another real estate is estimated based on predictor variables (i.e., size of properties and number of floors). 

\item Time series forecasts are solely based on historical data from the value to be predicted. No other variables are considered for the calculation, which on the one hand might miss some influential factors from external conditions but on the other hand appears to be more accurate regarding the output of the forecasts. 
In case of energy price forecasts external variables that change energy price behavior might include bids in auctions of wholesale energy markets, the current oil price or availability of renewable energy sources. However, in time series forecasts these variables are neglected to set the focus on the time series of historical energy prices. 
\end{itemize}


\subsection{Forecast accuracy}

There are different kinds of accuracy measures that can be applied to forecasting methods. \footnote{https://www.otexts.org/fpp/2/5}

\subsubsection{Scale-dependent error measures}

Scale dependent errors are absolute error measures given in the same scale as the dataset that is examined. Thus they are most useful when testing fc methods on the same dataset or on the same scale, respectively. 

\begin{itemize}
\item Mean absolute error (MAE)
The absolute error is defined by the value difference between a value of the dataset and its forecasted value. The mean absolute error returns the mean of all absolute errors on the dataset. [insert formula]

\item Root mean squared error (RMSE)
The root mean squared error takes the root of the sum of the squared forecast errors, and is scale dependent as well. [insert formula]

\end{itemize}

\subsubsection{Percentage error measures}

The most common percentage error is the mean absolute percentage error (MAPE) which is defined as the mean of percentage errors of a dataset. A percentage error is defined as $p_i=e_i/y_i * 100$. The mean absolute percentage error is then $mean(|pi|)$. 

The disadvantage of percentage error measures is that the value becomes infinite if there is some $y_i = 0$ on the dataset. Also, extreme values occur when the values on the dataset come close to zero. 



\subsection{Forecast models}

\subsubsection{ARIMA models}


\subsubsection{Exponential Smoothing models}


\subsection{Forecast model evaluation}

\subsubsection{Tests for appropriateness of forecasting models}

If a model has been chosen, it needs to be tested to ensure its applicability for the given dataset. 



\section{Time Series Processing}

\subsection{Decomposition of time series}

Decomposition of time series can be helpful to determine various trends and patterns in the dataset. Based on recognized patterns and a thorough analysis of the data´s behavior and characteristics an appropriate forecasting model can be chosen. 

A time series exhibiting a trend, seasonal variations and random fluctuations can be decomposed into a trend component, seasonal component and irregular component, respectively. 







\section{Simulation}

\subsection{Data Center Locations}

The framework will comprise seven data centers located in different countries and assigned to four different energy markets, namely the 
European energy exchange (EEX)\footnote{EEX: European energy exchange, http://www.eex.com/}, Nord Pool Spot\footnote{Nord Pool Spot, http://www.nordpoolspot.com/}, APX Power Spot Exchange\footnote{APX Power Spot Exchange, http://www.apxgroup.com/} and ISO New England\footnote{ISO New England, http://www.iso-ne.com/}. 


\subsubsection{Countries}

Germany, Switzerland, France (EEX), Finland (Nord Pool Spot), UK (APX Spot), Massachusetts and Maine (ISO New England)


\subsection{Power markets}

\subsubsection{EEX}

PHELIX: Physical Electricity Index: Germany, Austria

ELIX: Electricity Index: ?

SWISSIX: Swiss Index: Switzerland

FRENCH FINANCIAL POWER FUTURES: France


\subsection{Parameters}

\begin{itemize}
\item Migration Overhead / Costs

\item On/Off Peak Prices (e.g. UK, when no hourly prices are available)

\item different Time Zones

		Boston, Portland (-5)
		UK (UTC)
		Germany (+1)
		Finland(+2)
		
\item Considering cooling? 

		Fan/Chillers, turned off/on, which speed etc. 
		depending on outside temperature
		
\item Which kind of workload?

		applications running for short/long amount of time? 
		
\item Power consumption behavior

		Idle Servers
		
		Partially utilized Servers (max. 1 -> negligible)
		EXCEPT having jobs with different CPU-core demand
		
		Fully utilized Servers
		
\item What kind of forecasting? 

		Short term (day ahead, few days)
		
		Mid term (half a month up to a few months)
		
		Long term (half a year up to a few years)

\item How many VMs moved in one step? 

		May be defined, such that the migration pays concerning the running jobs. 

\item Considering different kinds of energy sources (renewables, Atom, fossils etc.)?

		Possible consideration in scheduling algorithm. Choosing priorities for either price or green IT. 

\end{itemize}



\section{Methodology}


\subsection{Forecasting}

A good explanation of forecasting can be found at \cite{weka2011weka} (from the weka forecasting tool). 
This is especially valid for time series forecasting but can be applied to other methods as well. 

\subsubsection{Models}

\begin{itemize}

\item Neural Networks

Finding some specifics on NN models ..

\item Regression Trees

Model (Regression) trees are decision trees with linear regression functions at the leaves. 

\item ...

\end{itemize}


\subsubsection{Forecast error classification}

(see \footnote{http://wiki.pentaho.com/display/DATAMINING/Time+Series+Analysis+and+Forecasting+with+Weka
\#TimeSeriesAnalysisandForecastingwithWeka-3.2.5Evaluation})

\begin{itemize}

\item Mean absolute error (MAE): $sum(abs(predicted - actual)) / N$

\item Mean squared error (MSE): $sum((predicted - actual)^2) / N$

\item Root mean squared error (RMSE): $sqrt(sum((predicted - actual)^2) / N)$

\item Mean absolute percentage error (MAPE): $sum(abs((predicted - actual) / actual)) / N$

\item Direction accuracy (DAC): \\
$count(sign(actual\_current - actual\_previous) == sign(pred\_current - pred\_previous)) / N$

\item Relative absolute error (RAE): \\
$sum(abs(predicted - actual)) / sum(abs(previous\_target - actual))$

\item Root relative squared error (RRSE): \\
$sqrt(sum((predicted - actual)^2) / N) / sqrt(sum(previous\_target - actual)^2) / N)$

\end{itemize}

\subsection{Dynamic request routing}

\begin{itemize}

\item kind of load balancing

\item Determines the currently cheapest data center (comparing energy prices in all areas)

\item combine with forecasting (prices)? 

\item Does load forecasting make sense ? 

\subitem Maybe combine forecasting with current DC load to get an estimated DC load? 

\end{itemize}

\subsection{VM Migration}

\begin{itemize}

\item \textbf{Minimum job duration} for amortization of costs?

\item Same VM / DataCenter Selection Mechanism as with dynamic request routing?

\end{itemize}

\subsubsection{Comparison of approaches}

\begin{itemize}

\item Compare above approaches both with and without forecasting

\item Compare overall electricity consumption / electricity costs

\subitem - Does consumption directly map to costs? 
\subitem - How to derive the power consumption, just by CPU load? (depends on elasticity)
\subitem - Should the migration costs be taken into account?

\end{itemize}


\printbibliography


\end{document}